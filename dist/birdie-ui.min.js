"use strict";class BiDataTable{constructor(idTable,options={renderJSON:null,showSearch:!0,showSelect:!0,showPaginate:!0,selectionNumber:[5,10,20,50],hideColumn:[],showHighlight:!1,fixedTable:!1,sortAnimate:!0,showTfooter:!0,removeColumnExport:[]}){this.headerDataTable=[],this.rowDataTable=[],this.dataTable=[],this.dataSorted=[],this.dataToRender=[],this.pageSize=5,this.assc=!1,this.dataSearch=[],this.i=0,this.controlDataArr=[],this.dataTableRaw=[],this.searchValue="",this.listHiding=[],this.selectionNumber=[5,10,20,50],this.selectElementString="",this.showHighlight=!1,this.listTypeDate=[],this.pageNow=1,this.removeColumnExport=[],this.tableElement=document.getElementById(idTable),this.options=options,this.detectTyped(),this.convertToJson(),this.paginateRender(),this.control(),this.search(),this.renderToHTML(),this.paginateUpdate(),null!=options.renderJSON&&options.hasOwnProperty("renderJSON")&&this.JSONinit(options.renderJSON),!options.showSelect&&options.hasOwnProperty("showSelect")&&null!=(idTable=document.getElementById("biSelectControl"))&&idTable.remove(),this.showHighlight=null==options?void 0:options.showHighlight,options.fixedTable&&options.hasOwnProperty("fixedTable")?null!=(idTable=this.tableElement)&&idTable.classList.add("table_layout_fixed"):null!=(idTable=this.tableElement)&&idTable.classList.remove("table_layout_fixed"),!options.showSearch&&options.hasOwnProperty("showSearch")&&null!=(idTable=document.getElementById("biSearchControl"))&&idTable.remove(),null!=options.hideColumn&&options.hasOwnProperty("hideColumn")&&(this.listHiding=options.hideColumn,this.DoHide()),null!=options.selectionNumber&&options.hasOwnProperty("selectionNumber")&&(this.selectionNumber=options.selectionNumber,this.changeSelect()),this.totalPages=this.divide().length}detectTyped(){var _a,getHead=null==(_a=this.tableElement)?void 0:_a.getElementsByTagName("th");for(let z=0;z<getHead.length;z++)getHead[z].attributes["type-date"]&&this.listTypeDate.push({HeaderIndex:z,dateVal:!0})}changeSelect(){this.selectElementString="";for(let x=0;x<this.selectionNumber.length;x++)this.selectElementString+=`<option value="${this.selectionNumber[x]}">${this.selectionNumber[x]}</option>`;var ElSelect=document.getElementById("biSelectControl");return ElSelect&&(ElSelect.innerHTML=this.selectElementString),this.selectElementString}control(){var spanOne=document.createElement("span");spanOne.innerHTML=`
        <div class="bi-datatable-controls">
            <div class="bi-dtc-select">
                <div class="ctr-select">
                    <select id="biSelectControl">
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
                </div>
            </div>
            <div class="bi-dtc-search">
                <div class="ctr-search">
                    <input type="text" id="biSearchControl" placeholder="Search">
                </div>
            </div>
        </div>
        `,this.tableElement.parentNode.insertBefore(spanOne,this.tableElement),this.tableElement.style.width="100%";const changeValueSelected=params=>{this.pageSize=params,this.i=0,this.renderToHTML()};spanOne=document.getElementById("biSelectControl");null!=spanOne&&spanOne.addEventListener("change",function(){changeValueSelected(this.value)}),document.getElementById("biPaginator__NEXT__X").onclick=()=>{this.nextItem(),this.highlight(this.searchValue),this.DoHide()},document.getElementById("biPaginator__PREV__X").onclick=()=>{this.prevItem(),this.highlight(this.searchValue),this.DoHide()}}nextItem(){this.i=this.i+1,this.i=this.i%this.divide().length,this.controlDataArr=this.divide()[this.i],this.renderToHTML(this.controlDataArr),this.pageNow=this.i+1}prevItem(){0===this.i&&(this.i=this.divide().length),this.i=this.i-1,this.pageNow=this.i+1,this.controlDataArr=this.divide()[this.i],this.renderToHTML(this.controlDataArr)}paginateRender(){var span=document.createElement("span");span.innerHTML=` 
        <div class="bi-datatable-paginator">
            <span id="biPaginator__PREV__X" class="bi-pg-prev">&laquo;</span>
            <div id="biPaginator__INFO" class="bi-pg-info"></div>
            <span id="biPaginator__NEXT__X" class="bi-pg-next">&raquo;</span>
        </div>
        `,this.tableElement.parentNode.insertBefore(span,this.tableElement.nextSibling)}paginateUpdate(){null!=document.getElementById("biPaginator__INFO")&&(document.getElementById("biPaginator__INFO").innerHTML=`
            <span>Page ${this.i+1} / ${this.divide().length} of ${void 0===this.dataTable?0:this.dataTable.length} Entries</span>`)}search(){var _a;this.dataSearch=this.dataTable,null!=(_a=document.getElementById("biSearchControl"))&&_a.addEventListener("input",evt=>{this.searchValue=evt.target.value,this.dataTable=this.dataSearch.filter(element=>{for(let index=0;index<this.headerDataTable.length;index++){var fg=element[this.headerDataTable[index]].toString().toLowerCase().includes(evt.target.value.toLowerCase());if(fg)return fg}}),this.renderToHTML(),this.i=0,this.paginateUpdate(),this.highlight(evt.target.value)})}convertToJson(){var _b,_a,getHead=null==(_a=this.tableElement)?void 0:_a.getElementsByTagName("th");for(let v=0;v<getHead.length;v++)null!=(_b=this.headerDataTable)&&_b.push(getHead[v].textContent);var getbody=null==(_a=this.tableElement)?void 0:_a.getElementsByTagName("tbody");for(let row=0;row<(void 0===getbody[0]?0:getbody[0].rows.length);row++){var cellsD=[];for(let cellsIndex=0;cellsIndex<getbody[0].rows[row].cells.length;cellsIndex++)cellsD.push(getbody[0].rows[row].cells[cellsIndex].innerHTML);this.rowDataTable.push(cellsD)}return this.dataTable=this.rowDataTable.reduce((akumulasi,e)=>(akumulasi.push(this.headerDataTable.reduce((x,y,i)=>(x[y]=e[i],x),{})),akumulasi),[]),this.dataTableRaw=this.dataTable,this.dataTable}divide(){var gh=[],h="string"==typeof this.pageSize?parseInt(this.pageSize):this.pageSize;for(let i=0;i<(void 0===this.dataTable?0:this.dataTable.length);i+=h)gh.push(this.dataTable.slice(i,i+h));return gh}renderToHTML(option=null){this.tableElement.innerHTML="";null!==this.dataSorted&&this.dataSorted!==[]&&this.dataSorted;var checkIfSorted=this.divide()[0];this.dataToRender=checkIfSorted;let header="",footer="";for(let i=0;i<this.headerDataTable.length;i++)header+=`<th style="cursor: pointer;" id="${this.headerDataTable[i]}_header" class="columns tablesorter-header">${this.headerDataTable[i]}</th>
`,footer+=`<th style="cursor: pointer;" id="${this.headerDataTable[i]}_footer" class="columns tablesorter-header">${this.headerDataTable[i]}</th>
`;var ifUndefinded=void 0===this.dataToRender?0:this.dataToRender.length;let row="";if(null===option)for(let ___row=0;___row<ifUndefinded;___row++){let ToCell="";for(let ___cell=0;___cell<this.headerDataTable.length;___cell++)ToCell+=`<td class="${this.headerDataTable[___cell]}__row">${this.dataToRender[___row][this.headerDataTable[___cell]]}</td>
`;row+=`<tr>${ToCell}</tr>
`}else{for(let ___row=0;___row<option.length;___row++){let ToCell="";for(let ___cell=0;___cell<this.headerDataTable.length;___cell++)ToCell+=`<td class="${this.headerDataTable[___cell]}__row">${option[___row][this.headerDataTable[___cell]]}</td>
`;row+=`<tr>${ToCell}</tr>
`}this.dataToRender=option}let ToEl=`<thead><tr>${header}</tr></thead><tbody>${row}</tbody>`;this.options.showTfooter&&(ToEl+=`<tfoot>${footer}</tfoot>`),this.tableElement.innerHTML=ToEl;for(let n=0;n<this.headerDataTable.length;n++){var cv=document.getElementById(this.headerDataTable[n]+"_header");document.getElementById(this.headerDataTable[n]+"_header").style.opacity="100%",cv.onclick=()=>{this.sort(this.headerDataTable[n]);var GetElsHeaderList=document.getElementById(this.headerDataTable[n]+"_header");if(document.getElementById(this.headerDataTable[n]+"_header").style.opacity="60%",this.assc?(GetElsHeaderList.classList.remove("tablesorter-header-asc"),GetElsHeaderList.classList.add("tablesorter-header-desc")):(GetElsHeaderList.classList.remove("tablesorter-header-desc"),GetElsHeaderList.classList.add("tablesorter-header-asc")),this.options.sortAnimate){const s=document.getElementsByClassName(this.headerDataTable[n]+"__row");for(let j=0;j<s.length;j++)setTimeout(()=>s[j].classList.add("blink_me"),21*j)}}}this.paginateUpdate(),this.DoHide()}sort(column){var t0=performance.now();function naturalCompare(a,b){const ax=[],bx=[];a.toString().replace(/(^\$|,)/g,"").replace(/(\d+)|(\D+)/g,function(_,$1,$2){ax.push([$1||1/0,$2||""])}),b.toString().replace(/(^\$|,)/g,"").replace(/(\d+)|(\D+)/g,function(_,$1,$2){bx.push([$1||1/0,$2||""])});for(let index=0;ax.length&&bx.length;index++){var an=ax.shift(),bn=bx.shift(),an=an[0]-bn[0]||an[1].localeCompare(bn[1]);if(an)return an}return ax.length-bx.length}const IndexHead=this.headerDataTable.indexOf(column);var listDated=this.listTypeDate.find(x=>x.HeaderIndex===IndexHead),listDated=(null==listDated?void 0:listDated.HeaderIndex)===IndexHead,data=this.dataTable,listDated=(this.assc?(this.assc=!this.assc,listDated?data.sort((a,b)=>Date.parse(a[column])-Date.parse(b[column])):data.sort((a,b)=>naturalCompare(a[column],b[column]))):(this.assc=!this.assc,listDated?data.sort((a,b)=>Date.parse(b[column])-Date.parse(a[column])):data.sort((a,b)=>naturalCompare(b[column],a[column]))),this.dataSorted=data,this.i=0,this.renderToHTML(),performance.now());return this.timeSort=Math.round((listDated-t0)/1e3*1e4)/1e4,this.dataSorted}excludeColumnExport(){var dataTable=JSON.parse(JSON.stringify(this.dataTable)),exlude=this.options.removeColumnExport,head=[...this.headerDataTable];for(let x=0;x<exlude.length;x++){var indexHead=head.indexOf(exlude[x]);-1<indexHead&&head.splice(indexHead,1)}for(let x=0;x<dataTable.length;x++)for(let n=0;n<exlude.length;n++)delete dataTable[x][exlude[n]];return{header:head,data:DataTable}}DownloadCSV(filename="Export"){var data=this.excludeColumnExport();let str="";var hed=data.header.toString();str=hed+"\r\n";for(let i=0;i<data.data.length;i++){let line="";for(const index in data.data[i])""!=line&&(line+=","),line+=data.data[i][index];str+=line+"\r\n"}hed=document.createElement("a");hed.href="data:text/csv;charset=utf-8,"+encodeURIComponent(str),hed.target="_blank",hed.download=filename+".csv",hed.click()}DownloadJSON(filename="Export"){var data=this.excludeColumnExport(),element=document.createElement("a");element.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(data.data)),element.target="_blank",element.download=filename+".json",element.click()}highlight(text){var _a;if(this.showHighlight){var getbody=null==(_a=this.tableElement)?void 0:_a.getElementsByTagName("tbody");for(let row=0;row<getbody[0].rows.length;row++)for(let cellsIndex=0;cellsIndex<getbody[0].rows[row].cells.length;cellsIndex++){let innerHTML=getbody[0].rows[row].cells[cellsIndex].innerHTML;var index=innerHTML.indexOf(text);0<=index&&(innerHTML=innerHTML.substring(0,index)+"<span style='background-color: yellow;'>"+innerHTML.substring(index,index+text.length)+"</span>"+innerHTML.substring(index+text.length),getbody[0].rows[row].cells[cellsIndex].innerHTML=innerHTML,getbody[0].rows[row].cells[cellsIndex].classList.add(this.headerDataTable[cellsIndex].replace(/\s/g,"_")+"__row"))}}}JSONinit(PayLoad=[]){this.headerDataTable=[];for(const key in PayLoad[0])this.headerDataTable.push(key);this.dataTable=PayLoad,this.dataSearch=PayLoad,this.renderToHTML()}HideCol(column){var Classes=document.getElementsByClassName(column+"__row");for(let O=0;O<Classes.length;O++)Classes[O].style.display="none";var ColmnHeader=document.getElementById(column+"_header"),column=document.getElementById(column+"_footer");ColmnHeader&&(ColmnHeader.style.display="none",column)&&(column.style.display="none")}ShowCol(column){var Classes=document.getElementsByClassName(column+"__row");for(let O=0;O<Classes.length;O++)Classes[O].style.display="";var ColmnHeader=document.getElementById(column+"_header"),column=document.getElementById(column+"_footer");ColmnHeader&&(ColmnHeader.style.display="",column)&&(column.style.display="")}DoHide(){var GetHeadArr=this.headerDataTable,ListOftrutc=[];for(let T=0;T<this.headerDataTable.length;T++)ListOftrutc.push(!0);for(let O=0;O<this.listHiding.length;O++){var Index=GetHeadArr.indexOf(this.listHiding[O]);-1<Index&&(ListOftrutc[Index]=!1)}var IndexTrue=[],IndexFalse=[];for(let U=0;U<ListOftrutc.length;U++)ListOftrutc[U]&&IndexTrue.push(U),ListOftrutc[U]||IndexFalse.push(U);for(let V=0;V<IndexTrue.length;V++)this.ShowCol(GetHeadArr[IndexTrue[V]]);for(let F=0;F<IndexFalse.length;F++)this.HideCol(GetHeadArr[IndexFalse[F]])}}export default BiDataTable;